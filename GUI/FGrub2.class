' Gambas class file

PUBLIC WorkDir AS String = Functions.Get_Str("/opt/Customizer/settings.conf", "WORK_DIR=", "/home")

PUBLIC SUB Form_Open()
  DIM ColorsArray AS String[]
  ME.Center
  ME.Caption = "Grub2"
  
  ModeBox.Add("NORMAL")
  ModeBox.Add("HIGHLIGHT")
  
  TRY SplashPic.Picture = Picture.Load(Functions.Get_Str(WorkDir & "/FileSystem/etc/default/grub", "GRUB_BACKGROUND=", "/boot/grubsplash.png"))

  ColorsArray = Split(Functions.Get_Str(WorkDir & "/FileSystem/etc/default/grub", "GRUB_COLOR_NORMAL=", "light-blue/black"), "/")
  Color1Box.Text = ColorsArray[0]
  Color2Box.Text = ColorsArray[1]
END

PUBLIC SUB Quit_Click()
  ME.Close
END

PUBLIC SUB Color1Box_Click()
  Functions.Replace_Str(WorkDir & "/FileSystem/etc/default/grub", "GRUB_COLOR_" & ModeBox.Text & "=", Color1Box.Text & "/" & Color2Box.Text)
END

PUBLIC SUB Color2Box_Click()
  Functions.Replace_Str(WorkDir & "/FileSystem/etc/default/grub", "GRUB_COLOR_" & ModeBox.Text & "=", Color1Box.Text & "/" & Color2Box.Text)
END

PUBLIC SUB ModeBox_Click()
  DIM ColorsArray AS String[]
  
  ColorsArray = Split(Functions.Get_Str(WorkDir & "/FileSystem/etc/default/grub", "GRUB_COLOR_" & ModeBox.Text & "=", "light-blue/black"), "/")
  Color1Box.Text = ColorsArray[0]
  Color2Box.Text = ColorsArray[1]
END

PUBLIC SUB ChangePic_Click()
  DIM PIC AS String

  PIC = Functions.Get_Str("/opt/Customizer/settings.conf", "PIC=", "")
  
  Dialog.Title = "Please select picture"
  Dialog.Filter = ["*.png;*.bmp;*.jpeg;*.jpg", "Pictures"]
  
  IF Exist(PIC) THEN
    Dialog.Path = PIC
  ELSE 
    Dialog.Path = "/home"
  ENDIF  
  
  IF Dialog.OpenFile() THEN RETURN 
  Functions.Replace_Str("/opt/Customizer/settings.conf", "PIC=", Dialog.Path)
  SHELL "convert -resize 800x600! -channel rgb '" & Dialog.Path & "' '" & WorkDir & "/FileSystem/boot/grubsplash.png'" WAIT
  Functions.Replace_Str(WorkDir & "/FileSystem/boot/grubsplash.png", "GRUB_BACKGROUND=", "/boot/grubsplash.png")
  SplashPic.Picture = Picture.Load(WorkDir & "/FileSystem/boot/grubsplash.png")
END
