' Gambas class file


PUBLIC SUB Form_Open()
  DIM WDir, BFiles, Edit, VRam, Res, SComp, FChroot, UColors, AHelper, ATitle, MDir AS String
  ME.Center
  ME.Caption = "Settings"
  
  IF Exist("/usr/bin/gedit") THEN
    EditorBox.Add("gedit")
  ENDIF 

  IF Exist("/usr/bin/medit") THEN
    EditorBox.Add("medit")
  ENDIF 
  
  IF Exist("/usr/bin/nedit") THEN
    EditorBox.Add("nedit")
  ENDIF 
  
  IF Exist("/usr/bin/mousepad") THEN
    EditorBox.Add("mousepad")
  ENDIF 
  
  IF Exist("/usr/bin/leafpad") THEN
    EditorBox.Add("leafpad")
  ENDIF 
  
  IF Exist("/usr/bin/geany") THEN
    EditorBox.Add("geany")
  ENDIF 
  
  IF Exist("/usr/bin/emacs") THEN
    EditorBox.Add("emacs")
  ENDIF 
  
  IF Exist("/usr/bin/kate") THEN
    EditorBox.Add("kate")
  ENDIF 
  
  IF Exist("/usr/bin/kwrite") THEN
    EditorBox.Add("kwrite")
  ENDIF 
  
  IF Exist("/usr/bin/bluefish") THEN
    EditorBox.Add("bluefish")
  ENDIF 
  
  IF Exist("/usr/bin/ultraedit") THEN
    EditorBox.Add("ultraedit")
  ENDIF 
  
  IF Exist("/usr/bin/scite") THEN
    EditorBox.Add("scite")
  ENDIF 
  
  IF Exist("/usr/bin/vi") THEN
    EditorBox.Add("vi")
  ENDIF 
  
  IF Exist("/usr/bin/vim") THEN
    EditorBox.Add("vim")
  ENDIF 
  
  IF Exist("/usr/bin/nano") THEN
    EditorBox.Add("nano")
  ENDIF 
  
  IF Exist("/usr/bin/pico") THEN
    EditorBox.Add("pico")
  ENDIF 
  
  SHELL "grep WORK_DIR= /opt/Customizer/settings.conf | sed 's/WORK_DIR=//;s/\"//g'" TO WDir
  SHELL "grep MOUNT_DIR= /opt/Customizer/settings.conf | sed 's/MOUNT_DIR=//;s/\"//g'" TO MDir
  SHELL "grep APPEND_TITLE= /opt/Customizer/settings.conf | sed 's/APPEND_TITLE=//'" TO ATitle
  SHELL "grep MESSAGES_COLORS= /opt/Customizer/settings.conf | sed 's/MESSAGES_COLORS=//'" TO UColors
  SHELL "grep FORCE_CHROOT= /opt/Customizer/settings.conf | sed 's/FORCE_CHROOT=//'" TO FChroot
  SHELL "grep APT_HELPER= /opt/Customizer/settings.conf | sed 's/APT_HELPER=//'" TO AHelper
  SHELL "grep EDITOR= /opt/Customizer/settings.conf | sed 's/EDITOR=//'" TO Edit
  SHELL "grep BOOT_FILES= /opt/Customizer/settings.conf | sed 's/BOOT_FILES=//;s/\"//g'" TO BFiles
  SHELL "grep VRAM= /opt/Customizer/settings.conf | sed 's/VRAM=//;s/\"//g'" TO VRam
  SHELL "grep RESOLUTION= /opt/Customizer/settings.conf | sed 's/RESOLUTION=//;s/\"//g'" TO Res
  SHELL "grep COMPRESSION= /opt/Customizer/settings.conf | sed 's/COMPRESSION=//;s/\"//g'" TO SComp
  

  TRY WorkDir.Text = Trim(WDir)
  TRY MountDir.Text = Trim(MDir)
  TRY AppendTitle.Value = Trim(ATitle)
  TRY UseColors.Value = Trim(UColors)
  TRY ForceChroot.Value = Trim(FChroot)
  TRY AptHelper.Value = Trim(AHelper)
  TRY EditorBox.Text = Trim(Edit)
  TRY BootFiles.Value = Trim(BFiles)
  TRY VirtualMemBox.Text = Trim(VRam)
  TRY ResolutionBox.Text = Trim(Res)
  TRY CompressionBox.Text = Trim(SComp)
  
  IF FMain.Build_ISO.Enabled = TRUE THEN 
    Message.Warning("Changing the working directory while in the middle of\ncustomization proccess is a stupid idea! To prevent you\nfrom doing so and probably harm your host OS this feature\nwill be disabled and you will have to clean to change it.")
    Change_WDir.Enabled = FALSE
    Change_WDir.ToolTip = "Changing the working directory is not possible at that state!"
  ENDIF 
END

PUBLIC SUB AppendTitle_Click()
  IF AppendTitle.Value = 0 THEN 
    SHELL "sed -i 's/APPEND_TITLE=.*/APPEND_TITLE=0/' /opt/Customizer/settings.conf"
  ELSE 
    SHELL "sed -i 's/APPEND_TITLE=.*/APPEND_TITLE=1/' /opt/Customizer/settings.conf"
  ENDIF 
END

PUBLIC SUB UseColors_Click()
  IF UseColors.Value = 0 THEN 
    SHELL "sed -i 's/MESSAGES_COLORS=.*/MESSAGES_COLORS=0/' /opt/Customizer/settings.conf"
  ELSE 
    SHELL "sed -i 's/MESSAGES_COLORS=.*/MESSAGES_COLORS=1/' /opt/Customizer/settings.conf"
  ENDIF 
END

PUBLIC SUB ForceChroot_Click()
  IF ForceChroot.Value = 0 THEN 
    SHELL "sed -i 's/FORCE_CHROOT=.*/FORCE_CHROOT=0/' /opt/Customizer/settings.conf"
  ELSE 
    SHELL "sed -i 's/FORCE_CHROOT=.*/FORCE_CHROOT=1/' /opt/Customizer/settings.conf"
  ENDIF 
END

PUBLIC SUB AptHelper_Click()
  IF AptHelper.Value = 0 THEN 
    SHELL "sed -i 's/APT_HELPER=.*/APT_HELPER=0/' /opt/Customizer/settings.conf"
  ELSE 
    SHELL "sed -i 's/APT_HELPER=.*/APT_HELPER=1/' /opt/Customizer/settings.conf"
  ENDIF 
END

PUBLIC SUB BootFiles_Click()
  IF BootFiles.Value = 0 THEN 
    SHELL "sed -i 's/BOOT_FILES=.*/BOOT_FILES=0/' /opt/Customizer/settings.conf"
  ELSE 
    SHELL "sed -i 's/BOOT_FILES=.*/BOOT_FILES=1/' /opt/Customizer/settings.conf"
  ENDIF 
END

PUBLIC SUB ResolutionBox_Click()
  SHELL "sed -i 's/RESOLUTION=.*/RESOLUTION=" & ResolutionBox.Text & "/' /opt/Customizer/settings.conf" 
END

PUBLIC SUB EditorBox_Click()
  SHELL "sed -i 's/EDITOR=.*/EDITOR=" & EditorBox.Text & "/' /opt/Customizer/settings.conf"
END

PUBLIC SUB VirtualMemBox_Click()
  SHELL "sed -i 's/VRAM=.*/VRAM=" & VirtualMemBox.Text & "/' /opt/Customizer/settings.conf"
END

PUBLIC SUB Change_WDir_Click()
  DIM WDir AS String
  SHELL "grep WORK_DIR= /opt/Customizer/settings.conf | sed 's/WORK_DIR=//;s/\"//g'" TO WorkDir
  
  Dialog.Title = "Please, select work directory"
  
  IF Exist(Trim(WDir)) THEN 
    Dialog.Path = Trim(WDir)
  ELSE 
    Dialog.Path = "/home"
  ENDIF 
  
  IF Dialog.SelectDirectory() THEN RETURN 
  SHELL "sed -i 's@WORK_DIR=.*@WORK_DIR=\"" & Dialog.Path & "\"@' /opt/Customizer/settings.conf" WAIT
  WorkDir.Text = Dialog.Path
END

PUBLIC SUB Change_MDir_Click()
  DIM MDir AS String
  SHELL "grep MOUNT_DIR= /opt/Customizer/settings.conf | sed 's/MOUNT_DIR=//;s/\"//g'" TO MDir
  
  Dialog.Title = "Please, select work directory"
  
  IF Exist(Trim(MDir)) THEN 
    Dialog.Path = Trim(MDir)
  ELSE 
    Dialog.Path = "/home"
  ENDIF 
  
  IF Dialog.SelectDirectory() THEN RETURN 
  SHELL "sed -i 's@MOUNT_DIR=.*@MOUNT_DIR=\"" & Dialog.Path & "\"@' /opt/Customizer/settings.conf" WAIT
  MountDir.Text = Dialog.Path
END

PUBLIC SUB CompressionBox_Click()
  SHELL "sed -i 's/COMPRESSION=.*/COMPRESSION=" & CompressionBox.Text & "/' /opt/Customizer/settings.conf"
END

PUBLIC SUB Quit_Click()
  ME.Close
END
